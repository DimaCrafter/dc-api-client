var e,t={};t={camelToKebab:function(e){let t=!1,s="";for(const n of e)n.toUpperCase()==n?(s+=t?n.toLowerCase():"-"+n.toLowerCase(),t=!0):(s+=n,t=!1);return"-"==s[0]?s.slice(1):s}};const s=function(e,s,n,o=null,c=null){return new Promise((i=>{var r=new XMLHttpRequest;o=function(e){if(!e)return null;let t=[],s=[],n=[],o=null;const c=JSON.stringify(e,((e,c)=>{if(!e)return t.push(c),c;for(;s.length&&s[0]!==this;)s.shift(),n.pop();return void 0!==c?c instanceof Blob?(o||(o=new FormData),"."==(e=n.join(".")+"."+e)[0]&&(e=e.slice(1)),void o.append(e,c)):(t.find((e=>e===c))||(n.push(e),s.unshift(c),t.push(c)),c):void 0}));return o?(o.append("json",c),o):c}(o),c=c?"?"+Object.entries(c).map((e=>e[0]+"="+e[1])).join("&"):"",e.useKebab&&(s=t.camelToKebab(s),n=t.camelToKebab(n)),r.open(o?"POST":"GET",`${e.secure?"https":"http"}://${e.base}/${s}/${n}${c}`),"string"==typeof o&&r.setRequestHeader("Content-type","application/json");let a,l=localStorage.getItem("session");l&&r.setRequestHeader("Session",l),r.send(o),r.onerror=()=>{i({success:!1,code:r.status,msg:r.statusText||r.response||"NetworkError"})},r.onreadystatechange=()=>{switch(r.readyState){case r.HEADERS_RECEIVED:a=r.getResponseHeader("content-type"),("application/octet-stream"==a||a.startsWith("image/"))&&(r.responseType="blob")}},r.onload=()=>{if(l=r.getResponseHeader("session"),l&&localStorage.setItem("session",l),"application/json"==a)try{i({success:200==r.status,code:r.status,msg:JSON.parse(r.response)})}catch(e){i({success:!1,code:-1,msg:e})}else i({success:200==r.status,code:r.status,msg:r.response})}}))};class n{constructor(e){this._events={},this._connection=null,this.socket=null;const t=s=>{this._socket=new WebSocket(`${e.settings.secure?"wss":"ws"}://${e.settings.base}/socket`),this._connection=new Promise((e=>{this._socket.onopen=()=>{this._socket.send("session:"+localStorage.getItem("session")),this._connection=null,e(),this._dispatch("open",[s>0]),s=0}})),this._socket.onmessage=e=>{var t=JSON.parse(e.data);"session"==t[0]&&localStorage.setItem("session",t[1]),this._dispatch(t[0],t.slice(1))},this._socket.onclose=n=>{this._socket._disableReconnect||-1!=e.settings.reconnectAttempts&&s==e.settings.reconnectAttempts?(this._dispatch("close",[n.code,n.reason]),this._socket=null):(this._dispatch("reconnect",[s+1]),setTimeout((()=>t(++s)),1e3*e.settings.reconnectTimeout))}};t(0)}_dispatch(e,t){const s=this._events[e];if(s)for(let e=0;e<s.length;e++)s[e].apply(null,t),s[e].once&&s.splice(e,1)}on(e,t){this._events[e]?this._events[e].push(t):this._events[e]=[t]}once(e,t){t.once=!0,this.on(e,t)}off(e,t){const s=this._events[e];if(s){var n=s.findIndex((e=>e===t));~n&&s.splice(n,1)}}emit(){let e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];const t=()=>this._socket.send(JSON.stringify(e));this._connection?this._connection.then(t):t()}close(){this._socket._disableReconnect=!0,this._socket.close(),this._dispatch("close",[0,"ManualClose"]),this._events={}}}const o=e=>(e._socketEmitter||(e._socketEmitter=new n(e),e._socketEmitter.on("close",(()=>{e._socketEmitter=null}))),e._socketEmitter);function c(e,t,s,n){void 0===t[s]?e[s]=n:e[s]=t[s]}let i;class r{constructor(e={}){c(this,e,"base",window.location.hostname),c(this,e,"secure",!0),c(this,e,"reconnectAttempts",5),c(this,e,"reconnectTimeout",2.5),c(this,e,"useKebab",!1)}}function a(e){return e.send=(...t)=>s(e.settings,...t),new Proxy(e,{get:function(t,n){return n in e?e[n]:"socket"==n.toLowerCase()?o(e):new Proxy({},{get:function(t,o){return(t,c)=>s(e.settings,n,o,t,c)}})}})}i=a({settings:new r,post:function(e,t,s=!1){var n=document.createElement("form");n.method="POST",n.action=e,s&&(n.target="_blank"),Object.entries(t).forEach((function(e){var t=document.createElement("input");t.name=e[0],t.value=e[1],n.appendChild(t)})),document.body.appendChild(n),n.submit(),n.remove()},instances:{},registerInstance:function(e,t){const s=a({settings:new r(t)});return this.instances[e]=s,s}}),e=i,window.API=e;